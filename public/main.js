'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'ui.bootstrap']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($state, $scope, $anchorScroll, TSP, QueryFactory, D3Factory, $location) {
      $scope.requestDone = false;

      $scope.sendQuery = function (query) {
            $scope.requestDone = true;
            $scope.loading = true;
            QueryFactory.sendQuery(query).then(function (response) {
                  console.log('back back back', response);
                  $scope.loading = false;
                  $scope.places = response;
                  QueryFactory.places = response;
                  $scope.length = response.length;
                  $location.hash('coordinates');
                  $anchorScroll();
                  // console.log('first set a coo', response[0].coordinates)
                  D3Factory.clearPlot();
            });
      };

      $scope.getDirections = function (locations) {
            // console.log('hit getDirections', locations)
            // var dataSet = locations.map(function(place){ return place.coordinates })
            var nn = TSP.nearestNeighbor(locations, locations[1].coordinates);
            D3Factory.clearPlot();
            $location.hash('map');
            $anchorScroll();
            D3Factory.showPlots(nn);
            // console.log('these is the output for shortest distance', nn)
      };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
'use strict';

app.controller('ModulesController', function ($scope, $http, ModulesFactory) {

  $scope.$on('$stateChangeSuccess', function () {
    var defaultMessage = 'If you don\'t see a list of links here, you need to seed your database!\nIn your terminal, go to this app\'s directory and run `gulp seedDB`.\nThen try this page again.';

    ModulesFactory.getNodeModules().then(function (modules) {
      $scope.nodeModules = modules;

      if (!$scope.nodeModules.length) {
        $scope.defaultMessage = defaultMessage;
      }
    });
  });
});
'use strict';

app.factory('ModulesFactory', function ($http) {
  return {
    getNodeModules: function getNodeModules() {
      return $http.get('/api/modules/').then(function (res) {
        return res.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('modules', {
        url: '/modules',
        templateUrl: '/app/modules/modules.html',
        controller: 'ModulesController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
'use strict';

var svg;
app.factory('D3Factory', function () {
	var polyLine;
	var map;
	return {
		clearPlot: function clearPlot() {
			console.log('IS IT CLEARING');
			if (svg) {
				map.removeLayer(polyLine);
				svg.selectAll('circle').remove();
			}
		},
		showPlots: function showPlots(dataSet) {
			// initialized map
			if (map) map.setView(dataSet[0].coordinates, 8);else {
				// doesn't
				map = L.map('map').setView(dataSet[0].coordinates, 8);
				var mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
				L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
					attribution: '&copy; ' + mapLink + ' Contributors',
					maxZoom: 18
				}).addTo(map);
			}

			// Initialize the SVG layer
			map._initPathRoot();

			var test = dataSet.map(function (d) {
				return d.coordinates;
			});
			polyLine = L.polyline(test).addTo(map);

			// We pick up the SVG from the map object
			svg = d3.select('#map').select('svg');
			var g = svg.append('g');

			dataSet.forEach(function (d) {
				d.LatLng = new L.LatLng(d.coordinates[0], d.coordinates[1]);
			});

			var tooltip = d3.select('body').append('div').attr('class', 'tooltip').style('opacity', 0);

			var feature = g.selectAll('circle').data(dataSet).enter().append('circle').style('stroke', 'black').style('fill', 'red').attr('r', 8).on('mouseover', function (d) {
				tooltip.transition().duration(200).style('opacity', 0.9);
				tooltip.html('<h5>Step: ' + d.step + '</h5><p>' + d.place + ' - ' + d.categories + '</p>').style('left', d3.event.pageX + 5 + 'px').attr('fill', '#215BB8').style('top', d3.event.pageY - 28 + 'px');
			}).on('mouseout', function (d) {
				tooltip.transition().duration(500).style('opacity', 0);
			});

			map.on('viewreset', update);
			update();

			function update() {
				feature.attr('transform', function (d) {
					return 'translate(' + map.latLngToLayerPoint(d.LatLng).x + ',' + map.latLngToLayerPoint(d.LatLng).y + ')';
				});
			}

			// var lat = dataSet.map(function(e){return e.coordinates[0]});
			// var long = dataSet.map(function(e){return e.coordinates[1]});
			// console.log('this be lat long arr', lat, long)

			// var xMax = Math.max.apply(null, lat); // height
			// var xMin = Math.min.apply(null, lat); // width
			// var yMax = Math.max.apply(null, long); // height
			// var yMin = Math.min.apply(null, long); // width

			// var w = 1800;
			// var h = 800;

			// // calculate max/min for x and y here if necessary
			// // var zoom = d3.behavior.zoom()
			// //  			.scaleExtent([1, 10])
			// //  			.on("zoom", zoomed);

			// var xScale = d3.scale.linear()
			//              .domain([xMin, xMax])
			//              .range([0,w]);

			// var yScale = d3.scale.linear()
			//              .domain([yMax, yMin])
			//              .range([0,h]);

			// svg = d3.select("#map")
			//     .append("svg")
			//     // .attr("width", w)
			//     // .attr("height",h)
			//     // .call(zoom)
			//     .append('svg:g')
			//     .attr('transform', 'translate(55,55)')
			//     .style("pointer-events", "all");

			// svg.selectAll("circle")
			//     .data(dataSet)
			//     .enter()
			//     .append("circle")
			//     .attr("cx", function(d) {
			//           return xScale(d.coordinates[0]);
			//     })
			//     .attr("cy", function(d) {
			//           return yScale(d.coordinates[1]);
			//     })
			//     .attr("r",4);

			// var xAxis = d3.svg.axis()
			//     .scale(xScale)
			//     .orient('bottom')
			//     .tickSize(1);

			// var yAxis = d3.svg.axis()
			//     .scale(yScale)
			//     .orient('left')
			//     .tickSize(1);

			// svg.selectAll('text')
			// 	.data(dataSet)
			// 	.enter()
			// 	.append('text')
			// 	.text(function(d){
			// 		return d.place + " - " + d.categories;
			// 	})
			// 	.attr("x", function(d) {
			// 	    return xScale(d.coordinates[0]);
			// 	})
			// 	.attr("y", function(d) {
			// 	   return yScale(d.coordinates[1]);
			// 	})
			// 	.attr("font-family", "sans-serif")
			// 				.attr("font-size", "11px")
			// 				.attr("fill", "red");

			// svg.append("svg:g")
			//     .attr("class", "xaxis")
			//     .attr("transform", "translate(0," + h + ")")
			//     .call(xAxis);

			// svg.append("svg:g")
			//     .attr("class", "yaxis")
			//     .call(yAxis);

			//    function zoomed() {
			// 	svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
			// };
		}
	};
});
'use strict';

app.factory('TSP', function () {
	return {
		nearestNeighbor: function nearestNeighbor(coordinates, start) {
			var count = 0;

			function NearestNeighbor(dataSet, startPoint) {
				this.dataSet = dataSet;
				this.startPoint = startPoint;
				this.nearestK;
				this.output = [];
			}

			NearestNeighbor.prototype.sortByX = function () {
				this.dataSet.sort(function (a, b) {
					return a.coordinates[0] - b.coordinates[0];
				});
				return this;
			};

			NearestNeighbor.prototype.getNearestK = function (k) {
				this.nearestK = this.dataSet.slice(0, k);
				return this;
			};

			NearestNeighbor.prototype.getNN = function () {
				var nearest = this.nextLocation();
				count++;
				nearest.step = count;
				this.output.push(nearest);
				this.startPoint = nearest.coordinates;
			};

			NearestNeighbor.prototype.nextLocation = function () {
				var sortedDistance = this.findDistance(this.nearestK);
				var idxOfNN = sortedDistance.shift().i;

				return this.dataSet.splice(idxOfNN, 1)[0];
			};

			NearestNeighbor.prototype.findDistance = function (arr) {
				var self = this;
				return arr.map(function (coo, idx) {
					var obj = {};
					obj.i = idx;
					obj.coordinates = coo.coordinates;
					obj.distance = self.pythagorean(coo.coordinates[0], coo.coordinates[1]);
					return obj;
				}).sort(function (a, b) {
					return a.distance - b.distance;
				});
			};

			NearestNeighbor.prototype.pythagorean = function (lat, longi) {
				var startX = this.startPoint[0];
				var startY = this.startPoint[1];
				return Math.sqrt(Math.pow(startX - lat, 2) + Math.pow(startY - longi, 2));
			};

			var nn = new NearestNeighbor(coordinates, start);
			var len = coordinates.length;

			for (var i = 0; i < len; i++) {
				nn.sortByX().getNearestK(3).getNN();
			}
			return nn.output;
		}
	};
});
'use strict';

app.factory('QueryFactory', function ($http) {
	return {
		sendQuery: function sendQuery(string) {
			var query = string.replace(/\s+/g, '+');
			console.log('query', query);
			var self = this;
			return $http.get('/api/home/' + query).then(function (response) {
				// self.places = response.data;
				console.log('this is places in sendQuery', self.places);
				return response.data;
			});
		},
		places: null,
		coordinates: function coordinates() {
			return this.places.map(function (place) {
				return place.coordinates;
			});
		}
	};
});
'use strict';

app.directive('loader', function ($compile) {
    return {
        restrict: 'E',
        template: '<img src="/app/common/directives/loader/plane2.gif" />'
    };
});
"use strict";

function NearestNeighbor(dataSet, startPoint) {
	this.dataSet = dataSet;
	this.startPoint = startPoint;
	this.nearestK;
	this.output = [];
}

NearestNeighbor.prototype.sortByX = function () {
	this.dataSet.sort(function (a, b) {
		return a[0] - b[0];
	});
	return this;
};

NearestNeighbor.prototype.getNearestK = function (k) {
	this.nearestK = this.dataSet.slice(0, k);
	return this;
};

NearestNeighbor.prototype.getNN = function () {
	var nearest = this.nextLocation();
	this.output.push(nearest);
	this.startPoint = nearest;
};

NearestNeighbor.prototype.nextLocation = function () {
	var sortedDistance = this.findDistance(this.nearestK);
	var idxOfNN = sortedDistance.shift().i;
	return this.dataSet.splice(idxOfNN, 1)[0];
};

NearestNeighbor.prototype.findDistance = function (arr) {
	var self = this;
	return arr.map(function (coo, idx) {
		var obj = {};
		obj.i = idx;
		obj.coordinates = coo;
		obj.distance = self.pythagorean(coo[0], coo[1]);
		return obj;
	}).sort(function (a, b) {
		return a.distance - b.distance;
	});
};

NearestNeighbor.prototype.pythagorean = function (lat, longi) {
	var startX = this.startPoint[0];
	var startY = this.startPoint[1];
	return Math.sqrt(Math.pow(startX - lat, 2) + Math.pow(startY - longi, 2));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLnN0YXRlLmpzIiwibW9kdWxlcy9tb2R1bGVzLmNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL21vZHVsZXMuZmFjdG9yeS5qcyIsIm1vZHVsZXMvbW9kdWxlcy5zdGF0ZS5qcyIsIm5hdmJhci9uYXZiYXIuZGlyZWN0aXZlLmpzIiwiY29tbW9uL2ZhY3Rvcmllcy9EMy5mYWN0b3J5LmpzIiwiY29tbW9uL2ZhY3Rvcmllcy9uZWFyZXN0LmZhY3RvcnkuanMiLCJjb21tb24vZmFjdG9yaWVzL3F1ZXJ5LmZhY3RvcnkuanMiLCJjb21tb24vZGlyZWN0aXZlcy9sb2FkZXIvbG9hZGVyLmpzIiwiY29tbW9uL2pzL25lYXJlc3ROZWlnaGJvdXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLEdBQUcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDOztBQUV0RSxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsa0JBQWtCLEVBQUUsaUJBQWlCLEVBQUU7O0FBRXpELG9CQUFpQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFbEMscUJBQWtCLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ3BDLENBQUMsQ0FBQzs7O0FDUEgsR0FBRyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFTLE1BQU0sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRTtBQUM5RyxZQUFNLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQzs7QUFFNUIsWUFBTSxDQUFDLFNBQVMsR0FBRyxVQUFTLEtBQUssRUFBQztBQUMvQixrQkFBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7QUFDNUIsa0JBQU0sQ0FBQyxPQUFPLEdBQUcs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LFVBQVMsQ0FBQyxFQUFDLENBQUMsRUFBQztBQUNwQixTQUFPLENBQUMsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQztFQUMvQixDQUFDLENBQUM7Q0FDSCxDQUFDOztBQUVGLGVBQWUsQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLFVBQVMsR0FBRyxFQUFFLEtBQUssRUFBQztBQUMzRCxLQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2hDLEtBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEMsUUFBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUMxRSxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ01lYW5pc2N1bGUnLCBbJ3VpLnJvdXRlcicsICd1aS5ib290c3RyYXAnXSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24gKCR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgIC8vIFRoaXMgdHVybnMgb2ZmIGhhc2hiYW5nIHVybHMgKC8jYWJvdXQpIGFuZCBjaGFuZ2VzIGl0IHRvIHNvbWV0aGluZyBub3JtYWwgKC9hYm91dClcbiAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbiAgIC8vIElmIHdlIGdvIHRvIGEgVVJMIHRoYXQgdWktcm91dGVyIGRvZXNuJ3QgaGF2ZSByZWdpc3RlcmVkLCBnbyB0byB0aGUgXCIvXCIgdXJsLlxuICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xufSk7IiwiYXBwLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgZnVuY3Rpb24oJHN0YXRlLCAkc2NvcGUsICRhbmNob3JTY3JvbGwsIFRTUCwgUXVlcnlGYWN0b3J5LCBEM0ZhY3RvcnksICRsb2NhdGlvbikge1xuICAgICRzY29wZS5yZXF1ZXN0RG9uZSA9IGZhbHNlO1xuXG4gIFx0JHNjb3BlLnNlbmRRdWVyeSA9IGZ1bmN0aW9uKHF1ZXJ5KXtcbiAgICAgICRzY29wZS5yZXF1ZXN0RG9uZSA9IHRydWU7XG4gIFx0XHQkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gIFx0XHRRdWVyeUZhY3Rvcnkuc2VuZFF1ZXJ5KHF1ZXJ5KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgXHRcdFx0Y29uc29sZS5sb2coJ2JhY2sgYmFjayBiYWNrJywgcmVzcG9uc2UpXG4gIFx0XHRcdCRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gIFx0XHRcdCRzY29wZS5wbGFjZXMgPSByZXNwb25zZTtcbiAgICAgICAgUXVlcnlGYWN0b3J5LnBsYWNlcyA9IHJlc3BvbnNlO1xuICBcdFx0XHQkc2NvcGUubGVuZ3RoID0gcmVzcG9uc2UubGVuZ3RoO1xuICBcdFx0XHQkbG9jYXRpb24uaGFzaCgnY29vcmRpbmF0ZXMnKTtcbiAgICAgICAgJGFuY2hvclNjcm9sbCgpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnZmlyc3Qgc2V0IGEgY29vJywgcmVzcG9uc2VbMF0uY29vcmRpbmF0ZXMpXG4gIFx0XHRcdEQzRmFjdG9yeS5jbGVhclBsb3QoKTtcbiAgXHRcdH0pO1xuICBcdH07XG5cbiAgICAkc2NvcGUuZ2V0RGlyZWN0aW9ucyA9IGZ1bmN0aW9uKGxvY2F0aW9ucyl7XG4gICAgICAvLyBjb25zb2xlLmxvZygnaGl0IGdldERpcmVjdGlvbnMnLCBsb2NhdGlvbnMpXG4gICAgICAvLyB2YXIgZGF0YVNldCA9IGxvY2F0aW9ucy5tYXAoZnVuY3Rpb24ocGxhY2UpeyByZXR1cm4gcGxhY2UuY29vcmRpbmF0ZXMgfSlcbiAgICAgIHZhciBubiA9IFRTUC5uZWFyZXN0TmVpZ2hib3IobG9jYXRpb25zLCBsb2NhdGlvbnNbMV0uY29vcmRpbmF0ZXMpO1xuICAgICAgRDNGYWN0b3J5LmNsZWFyUGxvdCgpO1xuICAgICAgJGxvY2F0aW9uLmhhc2goJ21hcCcpO1xuICAgICAgJGFuY2hvclNjcm9sbCgpO1xuICAgICAgRDNGYWN0b3J5LnNob3dQbG90cyhubik7XG4gICAgICAvLyBjb25zb2xlLmxvZygndGhlc2UgaXMgdGhlIG91dHB1dCBmb3Igc2hvcnRlc3QgZGlzdGFuY2UnLCBubilcbiAgICB9XG4gICAgXG59KTsiLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdob21lJywge1xuICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvaG9tZS5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJ1xuICAgIH0pO1xufSk7IiwiYXBwLmNvbnRyb2xsZXIoJ01vZHVsZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgTW9kdWxlc0ZhY3RvcnkpIHtcbiAgXG4gICRzY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRlZmF1bHRNZXNzYWdlID0gJ0lmIHlvdSBkb25cXCd0IHNlZSBhIGxpc3Qgb2YgbGlua3MgaGVyZSwgeW91IG5lZWQgdG8gc2VlZCB5b3VyIGRhdGFiYXNlIVxcbkluIHlvdXIgdGVybWluYWwsIGdvIHRvIHRoaXMgYXBwXFwncyBkaXJlY3RvcnkgYW5kIHJ1biBgZ3VscCBzZWVkREJgLlxcblRoZW4gdHJ5IHRoaXMgcGFnZSBhZ2Fpbi4nO1xuXG4gICAgTW9kdWxlc0ZhY3RvcnkuZ2V0Tm9kZU1vZHVsZXMoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24obW9kdWxlcykge1xuICAgICAgICAkc2NvcGUubm9kZU1vZHVsZXMgPSBtb2R1bGVzO1xuICAgICAgICBcbiAgICAgICAgaWYgKCEkc2NvcGUubm9kZU1vZHVsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgJHNjb3BlLmRlZmF1bHRNZXNzYWdlID0gZGVmYXVsdE1lc3NhZ2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9KTtcbn0pOyIsImFwcC5mYWN0b3J5KCdNb2R1bGVzRmFjdG9yeScsIGZ1bmN0aW9uKCRodHRwKSB7XG4gIHJldHVybiB7XG4gICAgZ2V0Tm9kZU1vZHVsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9tb2R1bGVzLycpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAgIHJldHVybiByZXMuZGF0YTtcbiAgICAgICAgfSk7ICAgIFxuICAgIH1cbiAgfTtcbn0pOyIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ21vZHVsZXMnLCB7XG4gICAgICAgIHVybDogJy9tb2R1bGVzJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL21vZHVsZXMvbW9kdWxlcy5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ01vZHVsZXNDb250cm9sbGVyJ1xuICAgIH0pO1xufSk7IiwiYXBwLmRpcmVjdGl2ZShcIm5hdmJhclwiLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiBcIkVcIixcblx0XHR0ZW1wbGF0ZVVybDogXCIvYXBwL25hdmJhci9uYXZiYXIuaHRtbFwiXG5cdH07XG59KTsiLCJ2YXIgc3ZnO1xuYXBwLmZhY3RvcnkoJ0QzRmFjdG9yeScsIGZ1bmN0aW9uKCl7XG5cdHZhciBwb2x5TGluZVxuXHR2YXIgbWFwO1xuXHRyZXR1cm4ge1xuXHRcdGNsZWFyUGxvdDogZnVuY3Rpb24oKXtcblx0XHRcdGNvbnNvbGUubG9nKCdJUyBJVCBDTEVBUklORycpXG5cdFx0XHRpZihzdmcpe1xuXHRcdFx0XHRtYXAucmVtb3ZlTGF5ZXIocG9seUxpbmUpXG5cdFx0XHRcdHN2Zy5zZWxlY3RBbGwoJ2NpcmNsZScpLnJlbW92ZSgpO1x0XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRzaG93UGxvdHM6IGZ1bmN0aW9uKGRhdGFTZXQpe1xuXHRcdFx0Ly8gaW5pdGlhbGl6ZWQgbWFwXG5cdFx0XHRpZihtYXApIG1hcC5zZXRWaWV3KGRhdGFTZXRbMF0uY29vcmRpbmF0ZXMsIDgpO1xuXHRcdFx0ZWxzZSB7XHRcblx0XHRcdFx0Ly8gZG9lc24ndFxuXHRcdFx0XHRtYXAgPSBMLm1hcCgnbWFwJykuc2V0VmlldyhkYXRhU2V0WzBdLmNvb3JkaW5hdGVzLCA4KTtcblx0XHRcdFx0dmFyIG1hcExpbmsgPSAnPGEgaHJlZj1cImh0dHA6Ly9vcGVuc3RyZWV0bWFwLm9yZ1wiPk9wZW5TdHJlZXRNYXA8L2E+Jztcblx0ICAgICAgIFx0XHRMLnRpbGVMYXllcignaHR0cDovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZycsIHtcblx0ICAgICAgICAgICAgXHRhdHRyaWJ1dGlvbjogJyZjb3B5OyAnICsgbWFwTGluayArICcgQ29udHJpYnV0b3JzJyxcblx0ICAgICAgICAgICAgXHRtYXhab29tOiAxOCxcblx0ICAgICAgICAgICAgfSkuYWRkVG8obWFwKTtcblx0ICAgICAgIFx0fVxuXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBTVkcgbGF5ZXJcblx0XHRcdG1hcC5faW5pdFBhdGhSb290KCkgICAgXG5cblx0XHRcdHZhciB0ZXN0ID0gZGF0YVNldC5tYXAoZnVuY3Rpb24oZCl7cmV0dXJuIGQuY29vcmRpbmF0ZXN9KTtcblx0XHRcdHBvbHlMaW5lID0gTC5wb2x5bGluZSh0ZXN0KS5hZGRUbyhtYXApO1xuXG5cdFx0XHQvLyBXZSBwaWNrIHVwIHRoZSBTVkcgZnJvbSB0aGUgbWFwIG9iamVjdFxuXHRcdFx0c3ZnID0gZDMuc2VsZWN0KFwiI21hcFwiKS5zZWxlY3QoXCJzdmdcIik7XG5cdFx0XHR2YXIgZyA9IHN2Zy5hcHBlbmQoXCJnXCIpO1xuXG4gICAgICAgICAgICBkYXRhU2V0LmZvckVhY2goZnVuY3Rpb24oZCl7XG4gICAgICAgICAgICBcdGQuTGF0TG5nID0gbmV3IEwuTGF0TG5nKGQuY29vcmRpbmF0ZXNbMF0sIGQuY29vcmRpbmF0ZXNbMV0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciB0b29sdGlwID0gZDMuc2VsZWN0KFwiYm9keVwiKS5hcHBlbmQoXCJkaXZcIilcbiAgIFx0XHRcdFx0LmF0dHIoXCJjbGFzc1wiLCBcInRvb2x0aXBcIilcbiAgIFx0XHRcdFx0LnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcblxuICAgICAgICAgICAgdmFyIGZlYXR1cmUgPSBnLnNlbGVjdEFsbChcImNpcmNsZVwiKVxuXHRcdFx0XHQuZGF0YShkYXRhU2V0KVxuXHRcdFx0XHQuZW50ZXIoKS5hcHBlbmQoXCJjaXJjbGVcIilcblx0XHRcdFx0LnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIikgICBcblx0XHRcdFx0LnN0eWxlKFwiZmlsbFwiLCBcInJlZFwiKVxuXHRcdFx0XHQuYXR0cihcInJcIiwgOClcblx0XHRcdFx0Lm9uKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uKGQpIHtcblx0XHRcdCAgICAgICAgdG9vbHRpcC50cmFuc2l0aW9uKClcblx0XHRcdCAgICAgICAgICAuZHVyYXRpb24oMjAwKVxuXHRcdFx0ICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgLjkpO1xuXHRcdFx0ICAgICAgICB0b29sdGlwLmh0bWwoJzxoNT5TdGVwOiAnK2Quc3RlcCsnPC9oNT48cD4nK2QucGxhY2UgKyBcIiAtIFwiICsgZC5jYXRlZ29yaWVzKyc8L3A+Jylcblx0XHRcdCAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCArIDUpICsgXCJweFwiKVxuXHRcdFx0ICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCAnIzIxNUJCOCcpXG5cdFx0ICAgICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZIC0gMjgpICsgXCJweFwiKTtcblx0ICAgICBcdCAgICB9KVxuXHRcdFx0ICAgIC5vbihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uKGQpIHtcblx0XHRcdCAgICAgICAgdG9vbHRpcC50cmFuc2l0aW9uKClcblx0XHRcdCAgICAgICAgICAuZHVyYXRpb24oNTAwKVxuXHRcdFx0ICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG5cdFx0XHQgICAgfSk7IFxuXG5cblx0XHRcdG1hcC5vbihcInZpZXdyZXNldFwiLCB1cGRhdGUpO1xuXHRcdFx0dXBkYXRlKCk7XG5cblx0XHRcdGZ1bmN0aW9uIHVwZGF0ZSgpIHtcblx0XHRcdFx0ZmVhdHVyZS5hdHRyKFwidHJhbnNmb3JtXCIsIFxuXHRcdFx0XHRmdW5jdGlvbihkKSB7IFxuXHRcdFx0XHRcdHJldHVybiBcInRyYW5zbGF0ZShcIisgXG5cdFx0XHRcdFx0XHRtYXAubGF0TG5nVG9MYXllclBvaW50KGQuTGF0TG5nKS54ICtcIixcIisgXG5cdFx0XHRcdFx0XHRtYXAubGF0TG5nVG9MYXllclBvaW50KGQuTGF0TG5nKS55ICtcIilcIjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdClcblx0XHRcdH0gXG5cblx0XHRcdFxuXG5cdFx0XHQvLyB2YXIgbGF0ID0gZGF0YVNldC5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29vcmRpbmF0ZXNbMF19KTtcblx0XHRcdC8vIHZhciBsb25nID0gZGF0YVNldC5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29vcmRpbmF0ZXNbMV19KTtcblx0XHRcdC8vIGNvbnNvbGUubG9nKCd0aGlzIGJlIGxhdCBsb25nIGFycicsIGxhdCwgbG9uZylcblxuXHRcdFx0Ly8gdmFyIHhNYXggPSBNYXRoLm1heC5hcHBseShudWxsLCBsYXQpOyAvLyBoZWlnaHRcblx0XHRcdC8vIHZhciB4TWluID0gTWF0aC5taW4uYXBwbHkobnVsbCwgbGF0KTsgLy8gd2lkdGhcblx0XHRcdC8vIHZhciB5TWF4ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgbG9uZyk7IC8vIGhlaWdodFxuXHRcdFx0Ly8gdmFyIHlNaW4gPSBNYXRoLm1pbi5hcHBseShudWxsLCBsb25nKTsgLy8gd2lkdGhcblxuXHRcdFx0Ly8gdmFyIHcgPSAxODAwO1xuXHRcdFx0Ly8gdmFyIGggPSA4MDA7XG5cblx0XHRcdC8vIC8vIGNhbGN1bGF0ZSBtYXgvbWluIGZvciB4IGFuZCB5IGhlcmUgaWYgbmVjZXNzYXJ5XG5cdFx0XHQvLyAvLyB2YXIgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKVxuICAgLy8gLy8gIFx0XHRcdC5zY2FsZUV4dGVudChbMSwgMTBdKVxuICAgLy8gLy8gIFx0XHRcdC5vbihcInpvb21cIiwgem9vbWVkKTtcblxuXHRcdFx0Ly8gdmFyIHhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXG5cdFx0XHQvLyAgICAgICAgICAgICAgLmRvbWFpbihbeE1pbiwgeE1heF0pIFxuXHRcdFx0Ly8gICAgICAgICAgICAgIC5yYW5nZShbMCx3XSk7XG5cblx0XHRcdC8vIHZhciB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxuXHRcdFx0Ly8gICAgICAgICAgICAgIC5kb21haW4oW3lNYXgsIHlNaW5dKVxuXHRcdFx0Ly8gICAgICAgICAgICAgIC5yYW5nZShbMCxoXSk7XG5cdFx0XHQgICAgICAgICAgICAgICAgICAgICBcblx0XHRcdC8vIHN2ZyA9IGQzLnNlbGVjdChcIiNtYXBcIilcblx0XHRcdC8vICAgICAuYXBwZW5kKFwic3ZnXCIpXG5cdFx0XHQvLyAgICAgLy8gLmF0dHIoXCJ3aWR0aFwiLCB3KVxuXHRcdFx0Ly8gICAgIC8vIC5hdHRyKFwiaGVpZ2h0XCIsaClcblx0XHRcdC8vICAgICAvLyAuY2FsbCh6b29tKVxuXHRcdFx0Ly8gICAgIC5hcHBlbmQoJ3N2ZzpnJylcblx0XHRcdC8vICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSg1NSw1NSknKVxuXHRcdFx0Ly8gICAgIC5zdHlsZShcInBvaW50ZXItZXZlbnRzXCIsIFwiYWxsXCIpO1xuXG5cdFx0XHQvLyBzdmcuc2VsZWN0QWxsKFwiY2lyY2xlXCIpXG5cdFx0XHQvLyAgICAgLmRhdGEoZGF0YVNldClcblx0XHRcdC8vICAgICAuZW50ZXIoKVxuXHRcdFx0Ly8gICAgIC5hcHBlbmQoXCJjaXJjbGVcIilcblx0XHRcdC8vICAgICAuYXR0cihcImN4XCIsIGZ1bmN0aW9uKGQpIHtcblx0XHRcdC8vICAgICAgICAgICByZXR1cm4geFNjYWxlKGQuY29vcmRpbmF0ZXNbMF0pOyBcblx0XHRcdC8vICAgICB9KVxuXHRcdFx0Ly8gICAgIC5hdHRyKFwiY3lcIiwgZnVuY3Rpb24oZCkge1xuXHRcdFx0Ly8gICAgICAgICAgIHJldHVybiB5U2NhbGUoZC5jb29yZGluYXRlc1sxXSk7IFxuXHRcdFx0Ly8gICAgIH0pXG5cdFx0XHQvLyAgICAgLmF0dHIoXCJyXCIsNCk7IFxuXG5cblx0XHRcdC8vIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKClcblx0XHRcdC8vICAgICAuc2NhbGUoeFNjYWxlKVxuXHRcdFx0Ly8gICAgIC5vcmllbnQoJ2JvdHRvbScpXG5cdFx0XHQvLyAgICAgLnRpY2tTaXplKDEpO1xuXG5cdFx0XHQvLyB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpXG5cdFx0XHQvLyAgICAgLnNjYWxlKHlTY2FsZSlcblx0XHRcdC8vICAgICAub3JpZW50KCdsZWZ0Jylcblx0XHRcdC8vICAgICAudGlja1NpemUoMSk7XG5cblx0XHRcdC8vIHN2Zy5zZWxlY3RBbGwoJ3RleHQnKVxuXHRcdFx0Ly8gXHQuZGF0YShkYXRhU2V0KVxuXHRcdFx0Ly8gXHQuZW50ZXIoKVxuXHRcdFx0Ly8gXHQuYXBwZW5kKCd0ZXh0Jylcblx0XHRcdC8vIFx0LnRleHQoZnVuY3Rpb24oZCl7XG5cdFx0XHQvLyBcdFx0cmV0dXJuIGQucGxhY2UgKyBcIiAtIFwiICsgZC5jYXRlZ29yaWVzO1xuXHRcdFx0Ly8gXHR9KVxuXHRcdFx0Ly8gXHQuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkge1xuXHRcdFx0Ly8gXHQgICAgcmV0dXJuIHhTY2FsZShkLmNvb3JkaW5hdGVzWzBdKTtcblx0XHRcdC8vIFx0fSlcblx0XHRcdC8vIFx0LmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQpIHtcblx0XHRcdC8vIFx0ICAgcmV0dXJuIHlTY2FsZShkLmNvb3JkaW5hdGVzWzFdKTtcblx0XHRcdC8vIFx0fSlcblx0XHRcdC8vIFx0LmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgIC8vIFx0XHRcdFx0LmF0dHIoXCJmb250LXNpemVcIiwgXCIxMXB4XCIpXG4gICAvLyBcdFx0XHRcdC5hdHRyKFwiZmlsbFwiLCBcInJlZFwiKTtcbiAgIFx0XHRcdFxuXG5cdFx0XHQvLyBzdmcuYXBwZW5kKFwic3ZnOmdcIilcblx0XHRcdC8vICAgICAuYXR0cihcImNsYXNzXCIsIFwieGF4aXNcIilcblx0XHRcdC8vICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgaCArIFwiKVwiKVxuXHRcdFx0Ly8gICAgIC5jYWxsKHhBeGlzKTtcblxuXHRcdFx0Ly8gc3ZnLmFwcGVuZChcInN2ZzpnXCIpXG5cdFx0XHQvLyAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInlheGlzXCIpXG5cdFx0XHQvLyAgICAgLmNhbGwoeUF4aXMpO1xuXG5cdFx0IC8vICAgIGZ1bmN0aW9uIHpvb21lZCgpIHtcblx0XHRcdC8vIFx0c3ZnLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBkMy5ldmVudC50cmFuc2xhdGUgKyBcIilzY2FsZShcIiArIGQzLmV2ZW50LnNjYWxlICsgXCIpXCIpO1xuXHRcdFx0Ly8gfTtcblxuXHRcdH1cblx0fVxufSlcblxuIiwiYXBwLmZhY3RvcnkoJ1RTUCcsIGZ1bmN0aW9uKCl7XG5cdHJldHVybiB7XG5cdFx0bmVhcmVzdE5laWdoYm9yOiBmdW5jdGlvbihjb29yZGluYXRlcywgc3RhcnQpe1xuXHRcdFx0dmFyIGNvdW50ID0gMDtcblxuXHRcdFx0ZnVuY3Rpb24gTmVhcmVzdE5laWdoYm9yKGRhdGFTZXQsIHN0YXJ0UG9pbnQpe1xuXHRcdFx0XHR0aGlzLmRhdGFTZXQgPSBkYXRhU2V0OyBcblx0XHRcdFx0dGhpcy5zdGFydFBvaW50ID0gc3RhcnRQb2ludDsgXG5cdFx0XHRcdHRoaXMubmVhcmVzdEs7XG5cdFx0XHRcdHRoaXMub3V0cHV0ID0gW107XG5cdFx0XHR9XG5cblx0XHRcdE5lYXJlc3ROZWlnaGJvci5wcm90b3R5cGUuc29ydEJ5WCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHRoaXMuZGF0YVNldC5zb3J0KGZ1bmN0aW9uKGEsYil7IFxuXHRcdFx0XHRcdHJldHVybiBhLmNvb3JkaW5hdGVzWzBdIC0gYi5jb29yZGluYXRlc1swXVxuXHRcdFx0XHR9KTsgXG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fTtcblxuXHRcdFx0TmVhcmVzdE5laWdoYm9yLnByb3RvdHlwZS5nZXROZWFyZXN0SyA9IGZ1bmN0aW9uKGspe1xuXHRcdFx0XHR0aGlzLm5lYXJlc3RLID0gdGhpcy5kYXRhU2V0LnNsaWNlKDAsayk7IFxuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH07XG5cblxuXHRcdFx0TmVhcmVzdE5laWdoYm9yLnByb3RvdHlwZS5nZXROTiA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHZhciBuZWFyZXN0ID0gdGhpcy5uZXh0TG9jYXRpb24oKTtcblx0XHRcdFx0Y291bnQrKztcblx0XHRcdFx0bmVhcmVzdC5zdGVwID0gY291bnQ7XG5cdFx0XHRcdHRoaXMub3V0cHV0LnB1c2gobmVhcmVzdCk7XG5cdFx0XHRcdHRoaXMuc3RhcnRQb2ludCA9IG5lYXJlc3QuY29vcmRpbmF0ZXM7XG5cdFx0XHR9O1xuXG5cdFx0XHROZWFyZXN0TmVpZ2hib3IucHJvdG90eXBlLm5leHRMb2NhdGlvbiA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHZhciBzb3J0ZWREaXN0YW5jZSA9IHRoaXMuZmluZERpc3RhbmNlKHRoaXMubmVhcmVzdEspO1xuXHRcdFx0XHR2YXIgaWR4T2ZOTiA9IHNvcnRlZERpc3RhbmNlLnNoaWZ0KCkuaTsgXG5cblx0XHRcdFx0cmV0dXJuIHRoaXMuZGF0YVNldC5zcGxpY2UoaWR4T2ZOTiwgMSlbMF07XG5cdFx0XHR9O1xuXG5cdFx0XHROZWFyZXN0TmVpZ2hib3IucHJvdG90eXBlLmZpbmREaXN0YW5jZSA9IGZ1bmN0aW9uKGFycil7XG5cdFx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdFx0cmV0dXJuIGFyci5tYXAoZnVuY3Rpb24oY29vLCBpZHgpe1xuXHRcdFx0XHRcdHZhciBvYmogPSB7fTtcblx0XHRcdFx0XHRvYmouaSA9IGlkeDtcblx0XHRcdFx0XHRvYmouY29vcmRpbmF0ZXMgPSBjb28uY29vcmRpbmF0ZXM7XG5cdFx0XHRcdFx0b2JqLmRpc3RhbmNlID0gc2VsZi5weXRoYWdvcmVhbihjb28uY29vcmRpbmF0ZXNbMF0sIGNvby5jb29yZGluYXRlc1sxXSk7XG5cdFx0XHRcdFx0cmV0dXJuIG9iajtcdFxuXHRcdFx0XHR9KS5zb3J0KGZ1bmN0aW9uKGEsYil7IFxuXHRcdFx0XHRcdHJldHVybiBhLmRpc3RhbmNlIC0gYi5kaXN0YW5jZTsgXG5cdFx0XHRcdH0pO1xuXHRcdFx0fTtcblxuXHRcdFx0TmVhcmVzdE5laWdoYm9yLnByb3RvdHlwZS5weXRoYWdvcmVhbiA9IGZ1bmN0aW9uKGxhdCwgbG9uZ2kpe1xuXHRcdFx0XHR2YXIgc3RhcnRYID0gdGhpcy5zdGFydFBvaW50WzBdO1xuXHRcdFx0XHR2YXIgc3RhcnRZID0gdGhpcy5zdGFydFBvaW50WzFdO1xuXHRcdFx0XHRyZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHN0YXJ0WCAtIGxhdCwgMikgKyBNYXRoLnBvdyhzdGFydFkgLSBsb25naSwgMikpO1xuXHRcdFx0fTtcblxuXHRcdFx0dmFyIG5uID0gbmV3IE5lYXJlc3ROZWlnaGJvcihjb29yZGluYXRlcywgc3RhcnQpO1xuXHRcdFx0dmFyIGxlbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDtcblx0XHRcdFxuXHRcdFx0Zm9yKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKXtcblx0XHRcdFx0bm4uc29ydEJ5WCgpLmdldE5lYXJlc3RLKDMpLmdldE5OKCk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbm4ub3V0cHV0O1xuXG5cdFx0fVxuXHR9XG5cbn0pIiwiYXBwLmZhY3RvcnkoJ1F1ZXJ5RmFjdG9yeScsIGZ1bmN0aW9uKCRodHRwKXtcblx0cmV0dXJue1xuXHRcdHNlbmRRdWVyeTogZnVuY3Rpb24oc3RyaW5nKXtcblx0XHRcdHZhciBxdWVyeSA9IHN0cmluZy5yZXBsYWNlKC9cXHMrL2csIFwiK1wiKTtcblx0XHRcdGNvbnNvbGUubG9nKCdxdWVyeScsIHF1ZXJ5KTtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvaG9tZS8nKyBxdWVyeSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdC8vIHNlbGYucGxhY2VzID0gcmVzcG9uc2UuZGF0YTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ3RoaXMgaXMgcGxhY2VzIGluIHNlbmRRdWVyeScsIHNlbGYucGxhY2VzKVxuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0cGxhY2VzOiBudWxsLFxuXHRcdGNvb3JkaW5hdGVzOiBmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMucGxhY2VzLm1hcChmdW5jdGlvbihwbGFjZSl7cmV0dXJuIHBsYWNlLmNvb3JkaW5hdGVzfSlcblx0XHR9XG5cdH07XG59KTtcblxuIiwiYXBwLmRpcmVjdGl2ZSgnbG9hZGVyJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgdGVtcGxhdGU6ICc8aW1nIHNyYz1cIi9hcHAvY29tbW9uL2RpcmVjdGl2ZXMvbG9hZGVyL3BsYW5lMi5naWZcIiAvPidcbiAgICB9O1xufSk7XG4iLCJmdW5jdGlvbiBOZWFyZXN0TmVpZ2hib3IoZGF0YVNldCwgc3RhcnRQb2ludCl7XG5cdHRoaXMuZGF0YVNldCA9IGRhdGFTZXQ7IFxuXHR0aGlzLnN0YXJ0UG9pbnQgPSBzdGFydFBvaW50OyBcblx0dGhpcy5uZWFyZXN0Sztcblx0dGhpcy5vdXRwdXQgPSBbXTtcbn1cblxuTmVhcmVzdE5laWdoYm9yLnByb3RvdHlwZS5zb3J0QnlYID0gZnVuY3Rpb24oKXtcblx0dGhpcy5kYXRhU2V0LnNvcnQoZnVuY3Rpb24oYSxiKXsgXG5cdFx0cmV0dXJuIGFbMF0gLSBiWzBdXG5cdH0pOyBcblx0cmV0dXJuIHRoaXM7XG59O1xuXG5OZWFyZXN0TmVpZ2hib3IucHJvdG90eXBlLmdldE5lYXJlc3RLID0gZnVuY3Rpb24oayl7XG5cdHRoaXMubmVhcmVzdEsgPSB0aGlzLmRhdGFTZXQuc2xpY2UoMCxrKTsgXG5cdHJldHVybiB0aGlzO1xufTtcblxuXG5OZWFyZXN0TmVpZ2hib3IucHJvdG90eXBlLmdldE5OID0gZnVuY3Rpb24oKXtcblx0dmFyIG5lYXJlc3QgPSB0aGlzLm5leHRMb2NhdGlvbigpO1xuXHR0aGlzLm91dHB1dC5wdXNoKG5lYXJlc3QpO1xuXHR0aGlzLnN0YXJ0UG9pbnQgPSBuZWFyZXN0O1xufTtcblxuTmVhcmVzdE5laWdoYm9yLnByb3RvdHlwZS5uZXh0TG9jYXRpb24gPSBmdW5jdGlvbigpe1xuXHR2YXIgc29ydGVkRGlzdGFuY2UgPSB0aGlzLmZpbmREaXN0YW5jZSh0aGlzLm5lYXJlc3RLKTtcblx0dmFyIGlkeE9mTk4gPSBzb3J0ZWREaXN0YW5jZS5zaGlmdCgpLmk7IFxuXHRyZXR1cm4gdGhpcy5kYXRhU2V0LnNwbGljZShpZHhPZk5OLCAxKVswXTtcbn07XG5cbk5lYXJlc3ROZWlnaGJvci5wcm90b3R5cGUuZmluZERpc3RhbmNlID0gZnVuY3Rpb24oYXJyKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHRyZXR1cm4gYXJyLm1hcChmdW5jdGlvbihjb28sIGlkeCl7XG5cdFx0dmFyIG9iaiA9IHt9O1xuXHRcdG9iai5pID0gaWR4O1xuXHRcdG9iai5jb29yZGluYXRlcyA9IGNvbztcblx0XHRvYmouZGlzdGFuY2UgPSBzZWxmLnB5dGhhZ29yZWFuKGNvb1swXSwgY29vWzFdKTtcblx0XHRyZXR1cm4gb2JqO1x0XG5cdH0pLnNvcnQoZnVuY3Rpb24oYSxiKXsgXG5cdFx0cmV0dXJuIGEuZGlzdGFuY2UgLSBiLmRpc3RhbmNlOyBcblx0fSk7XG59O1xuXG5OZWFyZXN0TmVpZ2hib3IucHJvdG90eXBlLnB5dGhhZ29yZWFuID0gZnVuY3Rpb24obGF0LCBsb25naSl7XG5cdHZhciBzdGFydFggPSB0aGlzLnN0YXJ0UG9pbnRbMF07XG5cdHZhciBzdGFydFkgPSB0aGlzLnN0YXJ0UG9pbnRbMV07XG5cdHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coc3RhcnRYIC0gbGF0LCAyKSArIE1hdGgucG93KHN0YXJ0WSAtIGxvbmdpLCAyKSk7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9